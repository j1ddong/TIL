# 데이터베이스

## 데이터베이스 기본

### 1. 엔터티

> 여러 개의 속성을 지닌 명사를 의미한다. 즉 실체, 객체라고 생각할 수 있다.

### 2. 릴레이션

> 데이터베이스에서 정보를 구분하여 저장하는 기본 단위이다. 엔터디에 관한 데이터를 데이터베이스는 릴레이션 하나에 담아서 관리한다.

- 릴레이션은 관계형 데이터베이스에서는 테이블이라고 하고, NoSQL 데이터베이스에서는 컬렉션이라고 한다.

### 3. 속성

> 릴레이션에서 관리하는 구체적이며 고유한 이름을 갖는 정보이다.

### 4. 도메인

> 릴레이션에 포함된 각각의 속성들이 가질 수 있는 값들의 집합을 말한다.

- 예를 들어 성별이라는 속성이 있다면, 이 속성이 가질 수 있는 값은 남,여라는 집합이 된다.

### 5. 필드와 레코드

> 필드는 열에 해당하는 가장 작은 단위의 데이터를 의미한다. 레코드는 테이블에 쌓이는 행 단위의 데이터를 의미한다.

### 6. 관계

1:1 관계, 1:N 관계, N:M 관계(1:N, 1:M  관계를 갖는 테이블 두개로 나눠서 설정한다)

### 7. 키

> 슈퍼키는 유일성을 만족하고, 후보키는 최소성까지 갖춘 키이다. 후보키 중에서 기본키로 선택되지 못한 키는 대체키가 된다. 유일성은 중복되는 값이 없으며, 최소성은 필드를 조합하지 않고 최소 필드만 써서 키를 형성할 수 있는 것을 말한다.

<img src="file:///C:/Users/jiunHan/Desktop/Git%20hub/TIL/images/keyRelation.PNG" title="" alt="" data-align="center">

#### 기본키

> 유일성과 최소성을 만족하는 키이다.

- 자연키: 중복된 값이 없는 필드, 언젠가는 변하는 속성을 갖는다

- 인조키: 인위적으로 아이디를 부여하여 만든 키

#### 외래키

> 다른 테이블의 기본키를 그대로 참조하는 값으로 개체와의 관계를 식별하는데 사용한다.

---

## ERD와 정규화

### 정규형 원칙

> 자료의 중복성은 감소해야 하고, 독립적인 관계는 별개의 릴레이션으로 표현해야 한다. 

### 제1정규형

> 릴레이션의 모든 도메인은 더 이상 분해될 수 없는 원자 값만으로 구성되어야 한다.

- 릴레이션 속성 값 중에서 한 개의 기본키에 대해 두 개 이상의 값을 가지는 반복 집합이 있어서는 안된다.

### 제2정규형

> 릴레이션이 제1정규형이며 부분 함수 종속성을 제거한 형태를 말한다.

- 기본키가 아닌 모든 속성이 기본키에 완전 함수 종속되어야 한다.

![](C:\Users\jiunHan\Desktop\Git%20hub\TIL\images\2nf.PNG)

PK: {유저ID, 수강명} 

- PK => 성취도 

- 유저 ID => 유저번호 [부분적 함수 종속성]

### 제3정규형

> 제2정규형이고 기본키가 아닌 모든 속성이 이행적 함수 종속을 만족하지 않는 상태를 말한다.

- 이행적 함수 종속
  
  - A => B, B => C가 존재하면 논리적으로 A => C가 성립하는데 이때 집합 C가 집합 A에 이행적으로 함수 종속이 되었다고 한다.

<img src="file:///C:/Users/jiunHan/Desktop/Git%20hub/TIL/images/3nf.PNG" title="" alt="" data-align="center">

- 유저 ID => 등급, 등급 => 할인율, 유저 ID => 할인율로 이행적 종속성

- 등급을 기준으로 릴레이션 분리

### 보이스/코드 정규형

> 제3정규형이고, 결정자가 후보키가 아닌 함수 종속 관계를 제거하여 릴레이션 함수 종속 관계에서 모든 결정자가 후보키인 상태를 말한다.

- 릴레이션 R이 함수 종속성 X => Y가 성립할 때 모든 결정자인 X가 후보키이면 BCNF 정규형이라고 한다.

![](C:\Users\jiunHan\Desktop\Git%20hub\TIL\images\bcnf.PNG)

- 각 수강명에 대해 한 학생은 오직 한 강사의 강의만 수강한다

- 각 강사는 한 수강명만 담당한다

- 한 수강명은 여러 강사가 담당할 수 있다.

{학번, 수강명} 혹은 {학번, 강사}가 후보키가 된다.

- 강사 속성이 수강명을 결정하지만 후보키가 아니므로 강사 속성을 분리한다.



---

## 트랜잭션과 무결성

### 트랙잭션

> 데이터베이스에서 하나의 논리적 기능을 수행하기 위한 작업의 단위, 여러 개의 쿼리들을 하나로 묶는 단위를 말한다.

#### 1. 원자성

트랜잭션과 관련된 일이 모두 수행되었거나 되지 않았거나를 보장하는 특징입니다.

- 커밋: 여러 쿼리가 성공적으로 처리되었다고 확정하는 명령어, 트랜잭션 단위로 수행

- 롤백: 트랜잭션으로 처리한 하나의 묶음 과정을 일어나기 전으로 돌리는 일

#### 2. 일관성

허용된 방식으로만 데이터를 변경해야 하는 것을 의미한다.

#### 3. 격리성

트랙잭션 수행 시 서로 끼어들지 못하는 것을 말한다.

#### 4. 지속성

성공적으로 수행된 트랜잭션은 영원히 반영되어야 하는 것을 의미한다.

### 무결성

> 데이터 정확성, 일관성, 유효성을 유지하는 것을 말한다.

- 개체 무결성: 기본키로 선택된 필드는 빈 값을 허용하지 않는다

- 참조 무결성: 서로 참조 관계에 있는 두 테이블의 데이터는 항상 일관된 값을 유지해야 한다.

- 고유 무결성: 특성 속성에 대해 고유한 값을 가지도록 조건이 주어진 경우 그 속성 값은 모두 고유한 값을 가진다.

- NULL 무결성: 특정 속성 값에 NULL이 올 수 없다는 조건이 주어진 경우 그 속성 값은 NULL이 될 수 없다.



---

## 인덱스

### B트리

![](C:\Users\jiunHan\Desktop\Git%20hub\TIL\images\b_tree.PNG)

트리 탐색은 맨 위 루트 노드부터 탐색이 일어나며 브랜치 노드를 거쳐 리프 노드까지 내려온다

---

## 조인

1. 중첩 루프 조인
   
   중첩 for문과 같은 원리로 조건에 맞는 조인을 하는 방법, 랜덤 접근에 대한 비용이 많이 증가하므로 대용량 테이블에서는 사용하지 않는다

2. 정렬 병합 조인
   
   각각의 테이블을 조인할 필드 기준으로 정렬하고 정렬이 끝난 이후에 조인작업을 수행하는 조인이다.
   
   조인할 때 쓸 적절한 인덱스가 없고 대용량 테이블들을 조인하고, 조인 조건으로 <, > 등 범위 비교 연산자가 있을 때 쓴다.

3. 해시 조인
   
   해시 테이블을 기반으로 조인하는 방법이다. 동등 조인에서만 사용할 수 있다.
